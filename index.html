<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>115å¹´åº¦å“¡å·¥åº§è«‡æœƒææ¡ˆå¹³å°</title>
  <!-- å¼•å…¥ç¾ä»£åŒ–æ€æºé»‘é«”ï¼Œæ”¯æ´å¤šç¨®å­—é‡ -->
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&display=swap" rel="stylesheet">
  <style>
    :root {
      /* é ‚ç´šæº«é¦¨èª¿è‰²ç›¤ - æ™¨æ›¦ä¸»é¡Œ */
      --bg-gradient: linear-gradient(135deg, #FDFBF9 0%, #FFF2EC 100%);
      --surface: #FFFFFF;
      --surface-dim: #F9F6F3;
      --primary: #FF7B54;
      --primary-hover: #E86036;
      --primary-light: #FFD6C4;
      --text-main: #2D241E;
      --text-muted: #7A6B5F;
      --border: #EAE0D8;
      --danger: #E74C3C;
      --success: #2ECC71;
      
      /* æŸ”å’Œæ·±é‚ƒé™°å½± (Soft UI) */
      --shadow-sm: 0 4px 12px rgba(45, 36, 30, 0.04);
      --shadow-md: 0 12px 32px rgba(45, 36, 30, 0.08);
      --shadow-lg: 0 24px 60px rgba(255, 123, 84, 0.15);
      --shadow-glow: 0 0 20px rgba(255, 123, 84, 0.4);
      
      --radius-xl: 32px;
      --radius-lg: 24px;
      --radius-md: 16px;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: 'Noto Sans TC', sans-serif;
      color: var(--text-main);
      background: var(--bg-gradient);
      line-height: 1.8;
      font-size: 18px;
      overflow-x: hidden;
      min-height: 100vh;
    }

    /* è­¦ç¤ºç‡ˆé–ƒçˆå±¤ */
    #sirenOverlay { position: fixed; inset: 0; pointer-events: none; z-index: 9999; display: none; }
    .siren-active { display: block !important; animation: sirenFlash 0.15s infinite alternate; }
    @keyframes sirenFlash {
      0% { background: rgba(231, 76, 60, 0.25); }
      100% { background: rgba(52, 152, 219, 0.25); }
    }

    .container { width: min(1080px, 92vw); margin: 0 auto; padding-bottom: 80px; }
    
    /* é ‚éƒ¨å°èˆª - æ¯›ç»ç’ƒç²¾å“åŒ– */
    .topbar { 
      position: sticky; top: 0; z-index: 100; 
      background: rgba(253, 251, 249, 0.85); 
      backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
      border-bottom: 1px solid rgba(255, 255, 255, 0.5); 
      padding: 16px 0;
      box-shadow: 0 4px 30px rgba(0, 0, 0, 0.03);
    }
    .inner { display: flex; align-items: center; justify-content: space-between; }
    .brand { font-weight: 900; color: var(--text-main); font-size: 22px; display: flex; align-items: center; gap: 10px; }
    .brand-icon { font-size: 24px; }
    .badge { font-size: 14px; padding: 6px 16px; border-radius: 50px; color: var(--primary-hover); background: rgba(255, 123, 84, 0.1); font-weight: 700; letter-spacing: 1px; }

    /* Hero å€åŸŸ - è¦–è¦ºå¼µåŠ› */
    .hero { margin-top: 30px; animation: fadeUp 0.8s ease-out; }
    .heroCard { 
      position: relative; overflow: hidden; border-radius: var(--radius-xl); 
      box-shadow: var(--shadow-md); height: 500px; background: #eee; 
    }
    .heroCard img { width: 100%; height: 100%; object-fit: cover; transition: transform 8s ease; }
    .heroCard:hover img { transform: scale(1.05); }
    .heroOverlay { position: absolute; inset: 0; background: linear-gradient(to top, rgba(20, 15, 10, 0.85) 0%, rgba(20, 15, 10, 0) 60%); }
    
    .heroText { position: absolute; left: 0; right: 0; bottom: 50px; padding: 0 40px; display: flex; justify-content: center; }
    .heroText .title { 
      background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px);
      border-radius: var(--radius-lg); padding: 40px 60px; 
      box-shadow: var(--shadow-lg); max-width: 900px; text-align: center; 
      border: 1px solid rgba(255,255,255,0.8);
    }
    .heroText h1 { font-size: 42px; color: var(--text-main); font-weight: 900; line-height: 1.3; margin: 0; letter-spacing: 0.5px; }
    .heroText p { margin-top: 15px; color: var(--text-muted); font-size: 20px; font-weight: 500; }

    /* Bento Grid ä»‹ç´¹å€ */
    .intro-grid { display: grid; grid-template-columns: 1.3fr 1fr; gap: 24px; margin: 40px 0; animation: fadeUp 0.8s ease-out 0.2s both; }
    
    .quote-section { 
      padding: 40px; background: linear-gradient(135deg, #FFF0E6, #FFE4D6); 
      border-radius: var(--radius-lg); box-shadow: var(--shadow-sm); 
      display: flex; flex-direction: column; justify-content: center; position: relative; overflow: hidden;
    }
    .quote-section::before { content: 'â€'; position: absolute; top: -20px; right: 20px; font-size: 150px; color: rgba(255,123,84,0.1); font-family: serif; line-height: 1; }
    .quote-text { font-size: 22px; font-weight: 700; color: var(--text-main); line-height: 1.6; z-index: 1; }
    
    .fun-section { 
      padding: 30px; background: var(--surface); border-radius: var(--radius-lg); 
      display: flex; align-items: center; gap: 24px; box-shadow: var(--shadow-sm); border: 1px solid var(--border); 
    }
    .fun-image { width: 140px; height: 140px; border-radius: 50%; overflow: hidden; flex-shrink: 0; border: 4px solid var(--surface-dim); box-shadow: var(--shadow-sm); }
    .fun-image img { width: 100%; height: 100%; object-fit: cover; }
    .fun-text h3 { color: var(--text-main); font-size: 22px; margin-bottom: 8px; font-weight: 900; }
    .fun-text p { font-size: 16px; color: var(--text-muted); line-height: 1.6; }

    /* æ²‰æµ¸å¼è¡¨å–®å€å¡Š */
    .section { 
      margin: 40px 0; padding: 60px; background: var(--surface); 
      border-radius: var(--radius-xl); box-shadow: var(--shadow-lg); 
      border: 1px solid rgba(255,255,255,0.8); animation: fadeUp 0.8s ease-out 0.4s both; 
    }
    .section-title { border-bottom: 2px dashed var(--border); padding-bottom: 25px; margin-bottom: 40px; }
    .section-title h2 { font-size: 34px; color: var(--text-main); font-weight: 900; margin-bottom: 5px; }
    .section-title p { color: var(--primary); font-weight: 700; font-size: 18px; display: flex; align-items: center; gap: 8px; }
    
    label { display: block; font-weight: 700; font-size: 20px; margin: 35px 0 12px; color: var(--text-main); }
    .required { color: var(--primary); margin-left: 6px; font-size: 22px; }
    
    /* ç¾ä»£åŒ–è¼¸å…¥æ¡† (å¾®äº’å‹•) */
    input[type="text"], textarea { 
      width: 100%; background: var(--surface-dim); border: 2px solid transparent; 
      border-radius: var(--radius-md); padding: 20px 24px; font-size: 18px; outline: none; 
      font-family: inherit; color: var(--text-main); transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); 
    }
    input[type="text"]::placeholder, textarea::placeholder { color: #AFA49C; }
    input[type="text"]:focus, textarea:focus { 
      background: var(--surface); border-color: var(--primary); 
      box-shadow: 0 8px 25px rgba(255, 123, 84, 0.15); transform: translateY(-2px); 
    }

    /* è† å›Šå¼å‹•æ…‹å–®é¸éˆ• */
    .radio-group { display: flex; gap: 20px; margin-top: 15px; }
    .radio-label { 
      flex: 1; text-align: center; padding: 20px; background: var(--surface-dim); 
      border: 2px solid transparent; border-radius: var(--radius-md); cursor: pointer; 
      font-weight: 700; font-size: 19px; color: var(--text-muted); transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); 
    }
    .radio-label:has(input:checked) { 
      background: rgba(255, 123, 84, 0.05); border-color: var(--primary); color: var(--primary-hover); 
      box-shadow: 0 8px 20px rgba(255, 123, 84, 0.15); transform: translateY(-2px); 
    }
    .radio-label input { display: none; }

    #identitySection { display: block; margin-top: 25px; padding: 30px; background: #FAFAF9; border-radius: var(--radius-lg); border: 1px dashed #DDCFC4; }
    .form-row { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 24px; }

    /* AI æ™ºæ…§å„€è¡¨æ¿ (æç¤ºæ¡†) */
    .hint { 
      margin-top: 40px; background: linear-gradient(180deg, #FFFFFF, #FFF9F5); 
      border: 2px solid var(--primary-light); border-radius: var(--radius-lg); 
      padding: 40px; display: none; box-shadow: var(--shadow-lg); position: relative; overflow: hidden; 
    }
    .hint::before { content:''; position:absolute; top:0; left:0; width:100%; height:6px; background: linear-gradient(90deg, var(--primary), var(--danger)); }
    .hint-title { font-size: 26px; font-weight: 900; color: var(--primary-hover); margin-bottom: 20px; display: flex; align-items: center; gap: 12px; }
    .hint-text { font-size: 19px; background: rgba(255,123,84,0.08); padding: 25px; border-radius: var(--radius-md); margin-bottom: 30px; border-left: 6px solid var(--primary); font-weight: 500; line-height: 1.8; }

    /* è¡¨æ ¼ç²¾å“åŒ– */
    .table-wrapper { overflow-x: auto; border-radius: var(--radius-md); border: 1px solid var(--border); box-shadow: var(--shadow-sm); }
    .history-table { width: 100%; border-collapse: collapse; font-size: 17px; background: var(--surface); min-width: 800px; }
    .history-table th { background: var(--primary); color: white; padding: 18px 24px; text-align: left; font-weight: 700; white-space: nowrap; }
    .history-table td { padding: 20px 24px; border-bottom: 1px solid var(--border); vertical-align: top; line-height: 1.6; }
    .history-table tbody tr:hover { background: #FFF9F5; }

    /* é ‚ç´šæŒ‰éˆ•äº’å‹• */
    .btn { 
      cursor: pointer; border-radius: 50px; padding: 22px 45px; font-weight: 900; font-size: 20px; 
      border: none; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); width: 100%; font-family: inherit; letter-spacing: 1px; 
    }
    .btnPrimary { background: linear-gradient(135deg, var(--primary), var(--danger)); color: #fff; margin-top: 40px; box-shadow: 0 10px 25px rgba(231, 76, 60, 0.3); }
    .btnPrimary:hover:not(:disabled) { transform: translateY(-4px); box-shadow: 0 15px 35px rgba(231, 76, 60, 0.4); }
    .btnPrimary:disabled { background: #ccc; box-shadow: none; cursor: not-allowed; color: #777; }
    
    .btnSuccess { background: var(--success); color: white; box-shadow: 0 8px 20px rgba(46, 204, 113, 0.3); }
    .btnSuccess:hover { background: #27AE60; transform: translateY(-3px); box-shadow: 0 12px 25px rgba(46, 204, 113, 0.4); }
    .btnDanger { background: var(--surface); color: var(--text-muted); border: 2px solid var(--border); }
    .btnDanger:hover { border-color: var(--danger); color: var(--danger); background: #FFF5F5; }
    
    /* æœ€çµ‚ç¢ºèªæ¡† (å¼·çƒˆå°æ¯”) */
    #finalConfirmCard { 
      display: none; background: #fff; border: 4px solid var(--danger); padding: 50px; 
      border-radius: var(--radius-xl); margin-top: 40px; text-align: center; 
      box-shadow: 0 24px 80px rgba(231, 76, 60, 0.2); animation: fadeUp 0.4s ease-out; 
    }
    .btn-giveup { background: var(--success); color: white; font-size: 24px; padding: 24px; margin-bottom: 25px; box-shadow: 0 10px 30px rgba(46, 204, 113, 0.3); } 
    .btn-giveup:hover { transform: scale(1.03); background: #27AE60; }
    .btn-force { background: transparent; color: #AFA49C; font-size: 18px; padding: 12px; width: auto; text-decoration: underline; } 
    .btn-force:hover { color: var(--danger); }

    /* æˆåŠŸé é¢ */
    .success { display: none; text-align: center; padding: 100px 40px; background: var(--surface); border-radius: var(--radius-xl); box-shadow: var(--shadow-lg); animation: fadeUp 0.6s ease-out; }
    .success h3 { font-size: 46px; color: var(--text-main); font-weight: 900; margin: 15px 0; }

    /* å”¯ç¾ Loading é®ç½© */
    #loadingOverlay { position: fixed; inset: 0; background: rgba(253, 251, 249, 0.9); backdrop-filter: blur(10px); z-index: 10000; display: none; flex-direction: column; align-items: center; justify-content: center; }
    .spinner { width: 70px; height: 70px; border: 6px solid rgba(255,123,84,0.2); border-top-color: var(--primary); border-radius: 50%; animation: spin 1s cubic-bezier(0.68, -0.55, 0.265, 1.55) infinite; margin-bottom: 30px; }
    
    @keyframes spin { 100% { transform: rotate(360deg); } }
    @keyframes fadeUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }

    /* RWD æ‰‹æ©Ÿç‰ˆæ¥µè‡´å„ªåŒ– (å¡ç‰‡åŒ–è¡¨æ ¼) */
    @media (max-width: 768px) {
      .intro-grid { grid-template-columns: 1fr; gap: 20px; }
      .heroText h1 { font-size: 32px; }
      .heroText .title { padding: 30px 20px; width: 92%; }
      .heroCard { height: 400px; }
      .form-row { grid-template-columns: 1fr; }
      .section { padding: 40px 25px; }
      .radio-group { flex-direction: column; gap: 15px; }
      
      /* è¡¨æ ¼è®Šè³ªæ„Ÿå¡ç‰‡ */
      .history-table, .history-table tbody, .history-table tr, .history-table td { display: block; width: 100%; }
      .history-table thead { display: none; }
      .history-table tr { margin-bottom: 25px; border: 2px solid var(--border); border-radius: var(--radius-md); padding: 20px; background: #fff; box-shadow: var(--shadow-sm); }
      .history-table td { padding: 10px 0; border: none; font-size: 17px; text-align: left; }
      .history-table td:nth-child(1)::before { content: "ğŸ“… æœƒè­°æ—¥æœŸï¼š"; font-weight: 900; color: var(--primary); display: inline-block; width: 110px; }
      .history-table td:nth-child(2)::before { content: "ğŸ’¬ è¨´æ±‚æ‘˜è¦ï¼š"; font-weight: 900; color: var(--text-main); display: block; margin-bottom: 8px; margin-top: 15px; }
      .history-table td:nth-child(3)::before { content: "âœ… è¾¦ç†çµæœï¼š"; font-weight: 900; color: var(--text-main); display: block; margin-top: 20px; margin-bottom: 8px; padding-top: 20px; border-top: 2px dashed var(--border); }
      .history-table td:nth-child(3) { color: var(--text-muted); }
    }
  </style>
</head>
<body>
  <!-- è¼‰å…¥ä¸­å‹•ç•« -->
  <div id="loadingOverlay">
    <div class="spinner"></div>
    <div style="font-weight:900; font-size:24px; color:var(--text-main); padding:0 20px; text-align:center;">æ­£åœ¨åˆ†ææ­·æ¬¡åº§è«‡æœƒä¹‹æ”¿ç­–æ¼”é€²...</div>
    <div style="color:var(--text-muted); font-size:18px; margin-top:10px;">AI æª¢ç´¢ç´„éœ€ 10-15 ç§’ï¼Œè«‹è€å¿ƒç­‰å€™</div>
  </div>

  <div id="sirenOverlay"></div>

  <!-- å…§åµŒæ¶ˆé˜²è»ŠéŸ³æ•ˆ (Web Audio API å°‡åœ¨è…³æœ¬ä¸­å‘¼å«ï¼Œä¸éœ€ HTML æ¨™ç±¤) -->

  <div class="topbar">
    <div class="container inner">
      <div class="brand"><span class="brand-icon">ğŸ’¬</span> å“¡å·¥åº§è«‡æœƒå¹³å°</div>
      <div class="badge" id="today"></div>
    </div>
  </div>

  <main class="container">
    <section class="hero">
      <figure class="heroCard">
        <img src="./1770205128981.jpg" alt="Hero"/>
        <div class="heroOverlay"></div>
        <div class="heroText">
          <div class="title">
            <h1>æ¯ä¸€ä»½å»ºè­°ï¼Œéƒ½æ˜¯æˆé•·çš„åŠ›é‡</h1>
            <p>é€éæ‚¨çš„è²éŸ³ï¼Œè®“æˆ‘å€‘ä¸€èµ·å»ºè¨­æ›´ç¾å¥½çš„å·¥ä½œç’°å¢ƒ ğŸ’ª</p>
          </div>
        </div>
      </figure>
    </section>

    <div class="intro-grid">
      <div class="quote-section">
        <div class="quote-text">ã€Œæ‚¨çš„æ¯ä¸€å€‹æƒ³æ³•éƒ½å¾ˆçè²´ï¼Œç„¡è«–å¤§å°ï¼Œéƒ½æ˜¯æˆ‘å€‘é€²æ­¥çš„å‹•åŠ›ã€‚è«‹æ”¾å¿ƒåˆ†äº«ï¼Œæˆ‘å€‘æœƒèªçœŸå‚¾è½ã€‚ã€</div>
      </div>
      <div class="fun-section">
        <div class="fun-image"><img src="./266207be87b246eb8d2e11c63eb5d224.png" alt="è¶£å‘³"/></div>
        <div class="fun-text">
          <h3>æœ‰è©±å°±èªªï¼Œä¸ç”¨å®¢æ°£ï¼</h3>
          <p>é–‹å¿ƒçš„äº‹ã€å›°æ“¾çš„äº‹ã€å·¥ä½œå»ºè­°ï¼Œéƒ½æ­¡è¿åˆ†äº«ï½</p>
        </div>
      </div>
    </div>

    <section class="section" id="formSection">
      <div class="section-title">
        <h2>å¡«å¯«æ‚¨çš„ææ¡ˆ</h2>
        <p>ğŸ’¡ é€å‡ºå¾Œï¼ŒAI ç³»çµ±å°‡è‡ªå‹•ç‚ºæ‚¨æ¯”å°æ­·å¹´ç›¸ä¼¼ç´€éŒ„</p>
      </div>
      
      <label>1. è«‹å•ææ¡ˆæ˜¯å¦å…·åï¼Ÿ <span class="required">*</span></label>
      <div class="radio-group">
        <label class="radio-label"><input type="radio" name="identity" value="named" checked onclick="toggleId(true)"> âœï¸ è¨˜ååæ˜ </label>
        <label class="radio-label"><input type="radio" name="identity" value="anon" onclick="toggleId(false)"> ğŸ•µï¸â€â™‚ï¸ ä¸è¨˜ååæ˜ </label>
      </div>

      <div id="identitySection">
        <label>å–®ä½ / è·ç¨± / å§“å <span class="required">*</span></label>
        <div class="form-row">
          <input type="text" id="dept" placeholder="å–®ä½ (å¦‚: ç½å®³æ¶æ•‘ç§‘)">
          <input type="text" id="jobTitle" placeholder="è·ç¨±">
          <input type="text" id="userName" placeholder="çœŸå¯¦å§“å">
        </div>
      </div>

      <label>5. å»ºè­°äº‹é … <span class="required">*</span></label>
      <textarea id="suggestion" rows="6" placeholder="è«‹è©³ç´°èªªæ˜æ‚¨åœ¨å¯¦å‹™ä¸Šè§€å¯Ÿåˆ°çš„å•é¡Œæˆ–å»ºè­°..."></textarea>

      <label>6. å…·é«”äº‹è­‰ / å»ºè­°æ–¹æ¡ˆ <span class="required">*</span></label>
      <textarea id="evidence" rows="4" placeholder="è«‹åˆ—å‡ºå…·é«”æ•¸æ“šã€ç›¸é—œå…¬æ–‡æˆ–æ‚¨å¿ƒç›®ä¸­çš„è§£æ±ºæ–¹æ¡ˆï¼ˆå¿…å¡«ï¼‰"></textarea>

      <label>7. é™„ä»¶ (é¸å¡«)</label>
      <div style="border: 2px dashed var(--primary); padding: 40px; text-align: center; background: rgba(255,123,84,0.03); border-radius: var(--radius-md); cursor: pointer; color: var(--primary-hover); font-weight: 700; transition: 0.3s;" onclick="alert('é™„ä»¶å°‡éš¨è¡¨å–®è‡ªå‹•å­˜æª”')" onmouseover="this.style.background='rgba(255,123,84,0.08)'" onmouseout="this.style.background='rgba(255,123,84,0.03)'">
        <div style="font-size: 36px; margin-bottom: 10px;">ğŸ“</div>é»æ“Šæˆ–æ‹–æ”¾æª”æ¡ˆä¸Šå‚³
      </div>

      <button class="btn btnPrimary" id="submitBtn" onclick="handleInitialSubmit()">ğŸ’Œ é€²è¡Œæ™ºèƒ½æ¯”å°èˆ‡é€å‡º</button>

      <!-- AI æ¯”å°çµæœ (é è¨­éš±è—) -->
      <div class="hint" id="dupHint">
        <div class="hint-title">ğŸ¤– æ­·æ¬¡åº§è«‡æœƒç›¸é—œç´€éŒ„æª¢ç´¢çµæœ</div>
        <div id="aiSummary" class="hint-text"></div>
        <div class="table-wrapper"><div id="historyTable"></div></div>
        
        <div id="decisionZone" style="margin-top:35px; display:grid; grid-template-columns: 1fr 1fr; gap:20px;">
            <button class="btn btnSuccess" onclick="window.location.reload()">ğŸ‘Œ æˆ‘å·²äº†è§£ï¼Œå–æ¶ˆæœ¬æ¬¡æäº¤</button>
            <button class="btn btnDanger" onclick="triggerSirenSequence()">å…§å®¹ä¸åŒï¼Œå …æŒé€å‡ºå»ºè­°</button>
        </div>
      </div>

      <!-- æœ€çµ‚ç¢ºèªæ¡† -->
      <div id="finalConfirmCard">
          <div style="font-size:34px; font-weight:900; color:var(--danger); margin-bottom:15px;">ğŸ“¢ æœ€å¾Œç¢ºèª</div>
          <p style="font-size:20px; margin-bottom:35px; color:var(--text-main); font-weight:500;">ç³»çµ±æ¯”å°ç™¼ç¾å·²æœ‰é«˜åº¦ç›¸ä¼¼çš„æ­·å¹´ç´€éŒ„ã€‚<br>å»ºè­°æ‚¨åƒé–±è¾¦ç†çµæœï¼Œé¿å…é‡è¤‡ææ¡ˆæµªè²»è¡Œæ”¿è³‡æºã€‚</p>
          <button class="btn btn-giveup" onclick="window.location.reload()">âœ… äº†è§£ï¼Œæˆ‘ä¸é€å‡ºäº†</button>
          <div style="margin-top:20px;">
             <button class="btn btn-force" onclick="finalSave()">âš ï¸ æˆ‘å·²ç¢ºèªé€™æ˜¯å…¨æ–°äº‹è­‰ï¼Œæ­£å¼å­˜æª”</button>
          </div>
      </div>
    </section>

    <section class="success" id="successBox">
      <div style="font-size: 100px; margin-bottom: 10px;">ğŸ‰</div>
      <h3>æäº¤æˆåŠŸï¼æ„Ÿè¬åƒèˆ‡</h3>
      <p style="font-size:22px; color:var(--text-muted); margin:15px 0 40px;">æ‚¨çš„å¯¶è²´å»ºè¨€å·²å®‰å…¨å­˜å…¥ç³»çµ±ï¼Œæˆ‘å€‘å°‡èªçœŸç ”è­°ã€‚ğŸ’š</p>
      <img src="./1769910482662.jpg" style="width:100%; max-width:600px; border-radius:var(--radius-lg); box-shadow: var(--shadow-lg);">
    </section>
  </main>

  <script>
    // âš ï¸ å‹™å¿…æ›¿æ›æ­¤ç¶²å€ç‚ºæ‚¨çš„ GAS éƒ¨ç½²ç¶²å€
    const GAS_URL = "https://script.google.com/macros/s/AKfycbzkVW4Fna1S2s38oWelc26FaoEUCE8UUoZHYlq00KGUTLBZ-VbHPavnjtCj1lCZG45i/exec";
    
    document.getElementById('today').textContent = `ğŸ“… ${new Date().toLocaleDateString('zh-TW', {year:'numeric', month:'2-digit', day:'2-digit'})}`;

    function toggleId(s) { document.getElementById('identitySection').style.display = s ? 'block' : 'none'; }

    // éŸ³æ•ˆç”¢ç”Ÿå™¨ï¼šæ¨¡æ“¬çœŸå¯¦æ¶ˆé˜²è»Š/æ•‘è­·è»Šè­¦ç¬› (Web Audio API)
    function playFireSiren() {
      const ctx = new (window.AudioContext || window.webkitAudioContext)();
      const osc = ctx.createOscillator();
      const gain = ctx.createGain();
      
      osc.type = "sawtooth"; // é‹¸é½’æ³¢ï¼Œè²éŸ³å…·ç©¿é€åŠ›
      osc.connect(gain);
      gain.connect(ctx.destination);
      
      const now = ctx.currentTime;
      // æ¶ˆé˜²è»ŠéŸ³é »è®ŠåŒ– (ä½->é«˜->ä½)
      osc.frequency.setValueAtTime(650, now);
      osc.frequency.linearRampToValueAtTime(1100, now + 0.5);
      osc.frequency.linearRampToValueAtTime(650, now + 1.0);
      
      gain.gain.setValueAtTime(0.2, now); // è¨­å®šé©ç•¶éŸ³é‡
      osc.start(now);
      osc.stop(now + 1.0);
    }

    // è§¸ç™¼ç´…è—é–ƒçˆèˆ‡éŸ³æ•ˆ
    function triggerSirenSequence() {
      const overlay = document.getElementById('sirenOverlay');
      overlay.classList.add('siren-active');
      
      // é€£çºŒæ’­æ”¾å…©æ¬¡è­¦ç¬›è²
      playFireSiren();
      setTimeout(playFireSiren, 1100);

      // 2.5ç§’å¾Œåœæ­¢é–ƒçˆï¼Œå½ˆå‡ºæœ€çµ‚ç¢ºèªå¡ç‰‡
      setTimeout(() => {
        overlay.classList.remove('siren-active');
        document.getElementById('decisionZone').style.display = 'none';
        document.getElementById('finalConfirmCard').style.display = 'block';
        window.scrollTo({ top: document.getElementById('finalConfirmCard').offsetTop - 80, behavior: 'smooth' });
      }, 2500);
    }

    // ç¬¬ä¸€éšæ®µï¼šé€å‡ºæ¯”å°
    async function handleInitialSubmit() {
      const q = document.getElementById('suggestion').value.trim();
      const e = document.getElementById('evidence').value.trim();
      if (!q || !e) return alert("ã€Œå»ºè­°äº‹é …ã€èˆ‡ã€Œå…·é«”äº‹è­‰ã€çš†ç‚ºå¿…å¡«é …ç›®å–”ï¼");

      const btn = document.getElementById('submitBtn');
      btn.disabled = true;
      document.getElementById('loadingOverlay').style.display = 'flex';

      try {
        const res = await fetch(GAS_URL, { method: "POST", body: JSON.stringify({ action: "query", query: q }) });
        const json = await res.json();
        document.getElementById('loadingOverlay').style.display = 'none';

        if (json.status === "success") {
          if (json.data.history && json.data.history.length > 0) {
            document.getElementById('dupHint').style.display = 'block';
            document.getElementById('aiSummary').innerText = json.data.summary;
            let h = '<table class="history-table"><thead><tr><th style="width:18%">æœƒè­°æ—¥æœŸ</th><th style="width:35%">è¨´æ±‚æ‘˜è¦</th><th style="width:47%">è¾¦ç†çµæœ</th></tr></thead><tbody>';
            json.data.history.forEach(item => {
              h += `<tr><td><b>${item.date}</b></td><td>${item.proposal}</td><td>${item.conclusion}</td></tr>`;
            });
            document.getElementById('historyTable').innerHTML = h + '</tbody></table>';
            
            btn.style.display = 'none';
            window.scrollTo({ top: document.getElementById('dupHint').offsetTop - 80, behavior: 'smooth' });
          } else {
            // ç„¡é‡è¤‡ï¼Œç›´æ¥å­˜æª”
            await finalSave();
          }
        }
      } catch (err) {
        document.getElementById('loadingOverlay').style.display = 'none';
        alert("é€£ç·šç•°å¸¸ï¼Œè«‹é‡è©¦");
        btn.disabled = false;
      }
    }

    // ç¬¬äºŒéšæ®µï¼šæœ€çµ‚å­˜æª”
    async function finalSave() {
      document.getElementById('finalConfirmCard').style.display = 'none';
      document.getElementById('loadingOverlay').style.display = 'flex';

      const formData = {
        identity: document.querySelector('input[name="identity"]:checked').value,
        dept: document.getElementById('dept').value,
        jobTitle: document.getElementById('jobTitle').value,
        userName: document.getElementById('userName').value,
        suggestion: document.getElementById('suggestion').value,
        evidence: document.getElementById('evidence').value
      };

      try {
        const res = await fetch(GAS_URL, { method: "POST", body: JSON.stringify({ action: "save", formData: formData }) });
        const json = await res.json();
        document.getElementById('loadingOverlay').style.display = 'none';
        
        if (json.status === "success") {
          document.getElementById('formSection').style.display = 'none';
          document.querySelector('.intro-grid').style.display = 'none';
          document.getElementById('successBox').style.display = 'block';
          window.scrollTo(0,0);
        }
      } catch (e) {
        document.getElementById('loadingOverlay').style.display = 'none';
        alert("å­˜æª”å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯é€£ç·šã€‚");
      }
    }
  </script>
</body>
</html>
