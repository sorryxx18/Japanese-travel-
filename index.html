<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>115å¹´åº¦å“¡å·¥åº§è«‡æœƒææ¡ˆå¹³å°</title>
  <!-- å¼•å…¥æ€æºé»‘é«” -->
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --cream: #FFF9F0; --warm-white: #FFFCF8; --soft-orange: #FFB088; --coral: #FF8C69;
      --warm-brown: #8B6F5C; --deep-brown: #6B5344; --text: #4A403A; --border: #F0E6DC;
      --shadow-soft: 0 8px 32px rgba(139, 111, 92, 0.12);
      --radius-lg: 32px; --radius-md: 16px; --radius-sm: 12px;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: 'Noto Sans TC', sans-serif;
      color: var(--text);
      background: linear-gradient(180deg, var(--cream) 0%, var(--warm-white) 100%);
      min-height: 100vh;
      line-height: 1.7;
    }

    /* è­¦ç¤ºç‡ˆå…¨è¢å¹•é–ƒçˆå±¤ */
    #sirenOverlay {
      position: fixed; inset: 0; pointer-events: none; z-index: 9999; display: none;
    }
    .siren-active {
      display: block !important;
      animation: sirenFlash 0.15s infinite;
    }
    @keyframes sirenFlash {
      0% { background: rgba(255, 0, 0, 0.3); }
      50% { background: rgba(0, 0, 255, 0.3); }
      100% { background: rgba(255, 0, 0, 0.3); }
    }

    /* å¯¬åº¦èª¿æ ¡è‡³ 1100px */
    .container { width: min(1100px, 94vw); margin: 0 auto; }

    .topbar {
      position: sticky; top: 0; z-index: 20; background: rgba(255, 252, 248, 0.95);
      backdrop-filter: blur(12px); border-bottom: 1px solid var(--border); padding: 14px 0;
    }
    .topbar .inner { display: flex; align-items: center; justify-content: space-between; }
    .brand { display: flex; align-items: center; gap: 10px; font-weight: 700; color: var(--deep-brown); font-size: 18px; }
    .brand-icon { width: 36px; height: 36px; background: linear-gradient(135deg, var(--soft-orange), var(--coral)); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 18px; }
    .badge { font-size: 12px; padding: 6px 14px; border-radius: 20px; color: var(--warm-brown); background: var(--soft-pink); font-weight: 500; }

    /* Hero å€åŸŸ - éœ‡æ’¼æ¨™é¡Œ 42px */
    .hero { margin-top: 24px; }
    .heroCard { position: relative; overflow: hidden; border-radius: var(--radius-lg); box-shadow: var(--shadow-soft); height: 480px; }
    .heroCard img { width: 100%; height: 100%; object-fit: cover; }
    .heroOverlay { position: absolute; inset: 0; background: linear-gradient(180deg, rgba(107, 83, 68, 0) 0%, rgba(107, 83, 68, 0.7) 100%); }
    .heroText { position: absolute; left: 28px; right: 28px; bottom: 28px; }
    .heroText .title { background: rgba(255, 252, 248, 0.96); border-radius: var(--radius-md); padding: 32px 40px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); max-width: 800px; }
    .heroText h1 { margin: 0; font-size: 42px; color: var(--deep-brown); font-weight: 700; line-height: 1.2; }
    .heroText p { margin-top: 10px; color: var(--text-light); font-size: 18px; }

    /* å¼•è¨€èˆ‡è¶£å‘³å€ */
    .quote-section { margin: 28px 0; padding: 24px 32px; background: #FFE4E1; border-radius: var(--radius-md); border-left: 4px solid var(--coral); display: flex; align-items: center; gap: 20px; }
    .quote-text { font-size: 18px; font-style: italic; }
    .fun-section { margin: 24px 0; padding: 24px; background: #FFF; border-radius: var(--radius-md); display: flex; align-items: center; gap: 24px; border: 2px dashed var(--soft-orange); }
    .fun-image { width: 200px; height: 130px; border-radius: var(--radius-sm); overflow: hidden; flex-shrink: 0; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
    .fun-image img { width: 100%; height: 100%; object-fit: cover; }

    /* è¡¨å–®å€åŸŸ */
    .section { margin: 24px 0; padding: 40px; background: var(--warm-white); border-radius: var(--radius-lg); box-shadow: var(--shadow-soft); border: 1px solid var(--border); }
    .section-title h2 { color: var(--deep-brown); font-size: 28px; font-weight: 700; }
    label { display: block; font-weight: 600; color: var(--deep-brown); font-size: 18px; margin: 20px 0 10px; }
    .required { color: var(--coral); margin-left: 4px; }
    input, textarea { width: 100%; border: 2px solid var(--border); border-radius: var(--radius-sm); padding: 16px; font-size: 17px; outline: none; background: white; font-family: inherit; }
    input:focus, textarea:focus { border-color: var(--soft-orange); box-shadow: 0 0 0 4px rgba(255, 176, 136, 0.15); }

    .radio-group { display: flex; gap: 30px; margin-top: 12px; padding: 16px 25px; background: var(--cream); border-radius: var(--radius-sm); border: 2px solid var(--border); }
    .radio-option { display: flex; align-items: center; gap: 10px; cursor: pointer; font-weight: 500; font-size: 17px; }

    #identitySection { display: block; margin-top: 10px; } /* é è¨­å±•é–‹ */
    .form-row { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 16px; }

    /* AI æ¯”å°å€å¡Š */
    .hint { margin-top: 25px; background: white; border: 3px solid var(--soft-orange); border-radius: var(--radius-md); padding: 30px; display: none; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
    .hint-title { color: #e67e22; font-weight: 700; font-size: 22px; margin-bottom: 15px; }
    .hint-text { font-size: 17px; background: #fffaf0; padding: 20px; border-radius: 12px; margin-bottom: 20px; border-left: 5px solid var(--soft-orange); }

    /* è¡¨æ ¼ RWD */
    .table-wrapper { overflow-x: auto; border-radius: 10px; border: 1px solid var(--border); margin-bottom: 20px; }
    .history-table { width: 100%; border-collapse: collapse; min-width: 600px; font-size: 16px; }
    .history-table th { background: var(--coral); color: white; padding: 14px; text-align: left; }
    .history-table td { padding: 14px; border-bottom: 1px solid var(--border); background: white; vertical-align: top; }

    /* æŒ‰éˆ• */
    .btn { cursor: pointer; border-radius: 50px; padding: 16px 40px; font-weight: 700; font-size: 18px; border: none; transition: 0.3s; width: 100%; font-family: inherit; }
    .btnPrimary { background: linear-gradient(135deg, var(--soft-orange), var(--coral)); color: #fff; margin-top: 30px; }
    .btnDanger { background: #d63031; color: white; margin-top: 20px; }
    
    .success { display: none; text-align: center; padding: 80px 20px; background: white; border-radius: var(--radius-lg); }

    @media (max-width: 768px) {
      .heroText h1 { font-size: 28px; }
      .heroCard { height: 350px; }
      .form-row { grid-template-columns: 1fr; }
      .fun-section { flex-direction: column; text-align: center; }
    }
  </style>
</head>
<body>
  <div id="sirenOverlay"></div>
  <audio id="sirenSound" src="https://www.soundjay.com/buttons/beep-01a.mp3" preload="auto"></audio>

  <div class="topbar"><div class="container"><div class="inner"><div class="brand"><span class="brand-icon">ğŸ’¬</span><span>å“¡å·¥åº§è«‡æœƒæ„è¦‹å¹³å°</span></div><div id="today" style="font-weight:700;"></div></div></div></div>

  <main class="container">
    <section class="hero">
      <figure class="heroCard">
        <img src="./1770205128981.jpg" alt="Hero"/>
        <div class="heroOverlay"></div>
        <div class="heroText"><div class="title"><h1>æ¯ä¸€ä»½å»ºè­°ï¼Œéƒ½æ˜¯æˆé•·çš„åŠ›é‡</h1><p>é€éæ‚¨çš„è²éŸ³ï¼Œè®“æˆ‘å€‘ä¸€èµ·å»ºè¨­æ›´ç¾å¥½çš„å·¥ä½œç’°å¢ƒ ğŸ’ª</p></div></div>
      </figure>
    </section>

    <div class="quote-section"><span style="font-size:40px;">âœ¨</span><p class="quote-text">ã€Œæ‚¨çš„æ¯ä¸€å€‹æƒ³æ³•éƒ½å¾ˆçè²´ï¼Œç„¡è«–å¤§å°ï¼Œéƒ½æ˜¯æˆ‘å€‘é€²æ­¥çš„å‹•åŠ›ã€‚è«‹æ”¾å¿ƒåˆ†äº«ï¼Œæˆ‘å€‘æœƒèªçœŸå‚¾è½ã€‚ã€</p></div>

    <div class="fun-section">
      <div class="fun-image"><img src="./266207be87b246eb8d2e11c63eb5d224.png" alt="è¶£å‘³"/></div>
      <div class="fun-text"><h3>ğŸ­ æœ‰è©±å°±èªªï¼Œä¸ç”¨å®¢æ°£ï¼</h3><p>ä¸ç®¡æ˜¯é–‹å¿ƒçš„äº‹ã€å›°æ“¾çš„äº‹ï¼Œé‚„æ˜¯å„é¡å·¥ä½œå»ºè­°ï¼Œéƒ½æ­¡è¿åœ¨é€™è£¡åˆ†äº«ï½æˆ‘å€‘ä¸€èµ·æƒ³è¾¦æ³•ï¼</p></div>
    </div>

    <section class="section" id="formSection">
      <div class="section-title"><h2>å¡«å¯«æ‚¨çš„ææ¡ˆ</h2><p style="color:var(--warm-brown); margin-top:5px;">ğŸ’¡ é€å‡ºå¾Œç³»çµ±å°‡è‡ªå‹•æ¯”å°æ­·å¹´ç›¸ä¼¼ç´€éŒ„</p></div>
      
      <label>1. è«‹å•ææ¡ˆæ˜¯å¦å…·åï¼Ÿ <span class="required">*</span></label>
      <div class="radio-group">
        <!-- å„ªå…ˆè¨˜åï¼šé è¨­ checked -->
        <label class="radio-option"><input type="radio" name="identity" value="named" checked onclick="toggleId(true)"><span>è¨˜ååæ˜ </span></label>
        <label class="radio-option"><input type="radio" name="identity" value="anon" onclick="toggleId(false)"><span>ä¸è¨˜å (åŒ¿å)</span></label>
      </div>

      <div id="identitySection">
        <label>2. å–®ä½ / è·ç¨± / å§“å <span class="required">*</span></label>
        <div class="form-row">
          <input type="text" id="dept" placeholder="å–®ä½ (å¦‚: è¨“ç·´ä¸­å¿ƒ)">
          <input type="text" id="jobTitle" placeholder="è·ç¨±">
          <input type="text" id="userName" placeholder="çœŸå¯¦å§“å">
        </div>
      </div>

      <label>5. å»ºè­°äº‹é … <span class="required">*</span></label>
      <textarea id="suggestion" rows="6" placeholder="è«‹è©³ç´°èªªæ˜æ‚¨çš„å»ºè­°æˆ–å•é¡Œé»..."></textarea>

      <!-- AI æ¯”å°çµæœå€ -->
      <div class="hint" id="dupHint">
        <div class="hint-title">ğŸ”” æ­·æ¬¡åº§è«‡æœƒç›¸é—œç´€éŒ„æª¢ç´¢çµæœ</div>
        <div id="aiSummary" class="hint-text">æ­£åœ¨èª¿é–±æª”æ¡ˆåº«...</div>
        <div class="table-wrapper"><div id="historyTable"></div></div>
        
        <div id="reconfirmZone" style="display:none; margin-top:25px; border-top: 2px dashed #ff7675; padding-top:25px;">
            <div style="color:#d63031; font-weight:700; font-size:20px; margin-bottom:15px;">âš ï¸ åµæ¸¬åˆ°å·²æœ‰ç›¸ä¼¼è¨è«–ç´€éŒ„</div>
            <p style="margin-bottom:20px;">è‹¥æ‚¨çš„å»ºè­°æœ‰æ–°çš„äº‹è­‰æˆ–è§€é»ï¼Œè«‹æŒ‰ä¸‹æ–¹æŒ‰éˆ•å …æŒé€å‡ºã€‚</p>
            <button class="btn btnDanger" id="forceSubmitBtn" onclick="handlePersistSubmit()">ç¢ºèªå…§å®¹ç„¡èª¤ï¼Œå …æŒé€å‡ºå»ºè­°</button>
        </div>
      </div>

      <label>6. å…·é«”äº‹è­‰ / å»ºè­°æ–¹æ¡ˆ <span class="required">*</span></label>
      <textarea id="evidence" rows="4" placeholder="è«‹åˆ—å‡ºå…·é«”æ•¸æ“šã€ç›¸é—œäº‹è­‰æˆ–æ‚¨çš„å…·é«”æ–¹æ¡ˆï¼ˆå¿…å¡«ï¼‰"></textarea>

      <button class="btn btnPrimary" id="submitBtn" onclick="handleInitialSubmit()">ğŸ’Œ é€å‡ºå»ºè­°äº‹é …</button>
    </section>

    <section class="success" id="successBox">
      <div style="font-size: 80px; margin-bottom: 20px;">ğŸ‰</div>
      <h3>æäº¤æˆåŠŸï¼æ„Ÿè¬åˆ†äº«</h3>
      <p style="font-size:20px; margin:20px 0;">æ‚¨çš„å»ºè¨€å·²å­˜å…¥ç³»çµ±ï¼Œæˆ‘å€‘å°‡èªçœŸç ”è­°ã€‚ğŸ’š</p>
      <img src="./1769910482662.jpg" style="width:100%; max-width:600px; border-radius:20px; box-shadow: var(--shadow-soft);">
    </section>
  </main>

  <script>
    const GAS_URL = "https://script.google.com/macros/s/AKfycbzkVW4Fna1S2s38oWelc26FaoEUCE8UUoZHYlq00KGUTLBZ-VbHPavnjtCj1lCZG45i/exec";
    
    document.getElementById('today').textContent = `ğŸ“… ${new Date().toLocaleDateString()}`;

    function toggleId(s) { document.getElementById('identitySection').style.display = s ? 'block' : 'none'; }

    // ç¬¬ä¸€æ¬¡é€å‡ºï¼šå•Ÿå‹•æ¯”å°ï¼Œä¸é–ƒçˆ
    async function handleInitialSubmit() {
      const suggestion = document.getElementById('suggestion').value.trim();
      const evidence = document.getElementById('evidence').value.trim();
      
      if (!suggestion || !evidence) return alert("ã€Œå»ºè­°äº‹é …ã€èˆ‡ã€Œå…·é«”äº‹è­‰ã€çš†ç‚ºå¿…å¡«é …ç›®ã€‚");

      const btn = document.getElementById('submitBtn');
      btn.disabled = true;
      btn.innerText = "ğŸ” æ­£åœ¨æœå°‹æ­·å¹´åº§è«‡æœƒæ•¸æ“š...";

      document.getElementById('dupHint').style.display = 'block';
      document.getElementById('aiSummary').innerText = "æ­£åœ¨ç©¿è¶Šæ™‚ç©ºèª¿é–±æ­·æ¬¡æœƒè­°ç´€éŒ„ï¼Œè«‹ç¨å€™...";
      window.scrollTo({ top: document.getElementById('dupHint').offsetTop - 100, behavior: 'smooth' });

      try {
        const res = await fetch(GAS_URL, { method: "POST", body: JSON.stringify({ action: "query", query: suggestion }) });
        const json = await res.json();
        
        if (json.status === "success") {
          document.getElementById('aiSummary').innerText = json.data.summary;
          
          if (json.data.history && json.data.history.length > 0) {
            let h = '<table class="history-table"><thead><tr><th>æœƒè­°æ—¥æœŸ</th><th>è¨´æ±‚æ‘˜è¦</th><th>è¾¦ç†çµæœ</th></tr></thead><tbody>';
            json.data.history.forEach(item => {
              h += `<tr><td><b>${item.date}</b></td><td>${item.proposal}</td><td>${item.conclusion}</td></tr>`;
            });
            document.getElementById('historyTable').innerHTML = h + '</tbody></table>';
            
            // é¡¯ç¤ºã€ŒäºŒæ¬¡ç¢ºèªå€ã€ï¼Œä½†ä¸è§¸ç™¼è²å…‰
            document.getElementById('reconfirmZone').style.display = 'block';
            btn.style.display = 'none'; 
          } else {
            // ç„¡é‡è¤‡ï¼Œç›´æ¥å­˜æª”
            await finalSave();
          }
        }
      } catch (e) {
        alert("æœå‹™ç¹å¿™ï¼Œè«‹é‡è©¦");
        btn.disabled = false;
        btn.innerText = "ğŸ’Œ é€å‡ºå»ºè­°äº‹é …";
      }
    }

    // ç¬¬äºŒæ¬¡é»æ“Šï¼šå …æŒé€å‡ºï¼Œæ­¤æ™‚è§¸ç™¼è­¦ç¤ºç‡ˆèˆ‡éŸ³æ•ˆ
    async function handlePersistSubmit() {
        triggerSiren(); // è§¸ç™¼ç´…è—é–ƒçˆ + éŸ³æ•ˆ
        
        const forceBtn = document.getElementById('forceSubmitBtn');
        forceBtn.disabled = true;
        forceBtn.innerText = "âš ï¸ è­¦ç¤ºç¢ºèªä¸­...";
        
        // å»¶é²ä¸€ä¸‹è®“åŒä»æ„Ÿå—åˆ°è­¦ç¤ºæ•ˆæœå†æ­£å¼å­˜æª”
        setTimeout(async () => {
            await finalSave();
        }, 1500);
    }

    function triggerSiren() {
      const overlay = document.getElementById('sirenOverlay');
      const sound = document.getElementById('sirenSound');
      overlay.classList.add('siren-active');
      sound.play().catch(e => console.log("Sound interaction required"));
      setTimeout(() => { overlay.classList.remove('siren-active'); }, 3000);
    }

    async function finalSave() {
      const formData = {
        identity: document.querySelector('input[name="identity"]:checked').value,
        dept: document.getElementById('dept').value,
        jobTitle: document.getElementById('jobTitle').value,
        userName: document.getElementById('userName').value,
        suggestion: document.getElementById('suggestion').value,
        evidence: document.getElementById('evidence').value
      };

      try {
        const res = await fetch(GAS_URL, { method: "POST", body: JSON.stringify({ action: "save", formData: formData }) });
        const json = await res.json();
        if (json.status === "success") {
          document.getElementById('formSection').style.display = 'none';
          document.getElementById('successBox').style.display = 'block';
          window.scrollTo(0,0);
        }
      } catch (e) { alert("å­˜æª”å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯é€£ç·š"); }
    }
  </script>
</body>
</html>
